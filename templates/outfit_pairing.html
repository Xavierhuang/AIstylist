<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outfit Pairing | AI Stylist</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f3f5;
            color: #333;
        }
        .navbar {
            background-color: #e75480;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .navbar h1 {
            margin: 0;
            font-size: 24px;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            margin-left: 15px;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .outfit-display {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-bottom: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            background-image: none;
            border: 2px dashed #e75480;
        }
        .outfit-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            border: none;
            border-radius: 0;
            padding: 5px;
            position: relative;
        }
        .outfit-item:first-child {
            z-index: 2;
        }
        .outfit-item:last-child {
            margin-top: -20px;
            z-index: 1;
        }
        .outfit-item img {
            max-width: 100%;
            max-height: 220px;
            object-fit: contain;
        }
        .outfit-label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
        }
        .clothing-gallery {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .gallery-section {
            flex: 1;
        }
        .gallery-title {
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #333;
        }
        .gallery-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }
        .gallery-item {
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            background-color: white;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .gallery-item.selected {
            border: 3px solid #4CAF50;
        }
        .gallery-item img {
            width: auto;
            height: auto;
            max-width: 90%;
            max-height: 140px;
            object-fit: contain;
            display: block;
        }
        .gallery-item {
            position: relative;
        }
        .delete-item-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .gallery-item:hover .delete-item-btn {
            opacity: 1;
        }
        .delete-confirmation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .delete-confirmation-box {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            max-width: 400px;
            text-align: center;
        }
        .delete-confirmation-box h3 {
            margin-top: 0;
            color: #e75480;
        }
        .delete-confirmation-box p {
            margin-bottom: 20px;
        }
        .delete-confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .delete-cancel-btn {
            background-color: #888;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .delete-confirm-btn {
            background-color: #ff3b3b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .button-container {
            text-align: center;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .clear-button {
            background-color: #888;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        .clear-button:hover {
            background-color: #777;
        }
        .suggest-button {
            background-color: #9370DB;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        .suggest-button:hover {
            background-color: #8360cb;
        }
        .save-button {
            background-color: #e75480;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        .save-button:hover {
            background-color: #d64d78;
        }
        .mannequin-title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 15px;
            color: #e75480;
            font-weight: 600;
        }
        .style-categories {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .style-category {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .style-category:hover, .style-category.active {
            background-color: #e75480;
            color: white;
            border-color: #e75480;
        }
        .outfit-rating {
            display: flex;
            justify-content: center;
            gap: 2px;
        }
        .outfit-rating .star {
            font-size: 14px;
        }
        .star {
            color: #ddd;
            font-size: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .star:hover, .star.active {
            color: #FFD700;
        }
        .compliment-box {
            margin-top: 15px;
            padding: 10px 15px;
            background-color: #fcf2f6;
            border-radius: 10px;
            text-align: center;
            font-style: italic;
            color: #e75480;
            font-size: 16px;
            display: none;
        }
        #selected-upper-img {
            max-height: 200px;
        }
        #selected-bottom-img {
            max-height: 260px;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            width: 100%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            padding: 0 5px;
            box-sizing: border-box;
        }
        .nav-button {
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .nav-button:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
        .saved-outfits {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .saved-outfits-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: #e75480;
            font-weight: 600;
            text-align: center;
        }
        .saved-outfits-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .saved-outfit {
            border: 1px solid #f0f0f0;
            border-radius: 15px;
            padding: 15px;
            width: 250px;
            background-color: white;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .saved-outfit:hover {
            transform: translateY(-5px);
        }
        .saved-outfit .outfit-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .saved-outfit img {
            max-width: 100%;
            max-height: 150px;
            object-fit: contain;
        }
        .saved-outfit .delete-outfit {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #e75480;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .saved-outfit .outfit-details {
            margin-top: 10px;
            text-align: center;
        }
        .saved-outfit .style-tag {
            display: inline-block;
            background-color: #f0e6f0;
            color: #9370DB;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: 600;
            text-transform: capitalize;
        }
        .saved-outfit .event-tag {
            display: inline-block;
            background-color: #f8e5ee;
            color: #e75480;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-weight: 600;
            text-transform: capitalize;
        }
        .saved-outfit .tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        .event-suggestion {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        .event-suggestion-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: #e75480;
            font-weight: 600;
        }
        .event-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .event-button {
            background-color: #f8e5ee;
            color: #e75480;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .event-button:hover {
            background-color: #e75480;
            color: white;
        }
        .event-button.active {
            background-color: #e75480;
            color: white;
        }
        .event-description {
            color: #666;
            font-style: italic;
            margin-top: 0;
            margin-bottom: 20px;
            min-height: 20px;
            text-align: center;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .upload-wardrobe {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        .upload-wardrobe-title {
            font-size: 22px;
            margin-bottom: 15px;
            color: #e75480;
            font-weight: 600;
        }
        .upload-wardrobe-description {
            margin-bottom: 20px;
            color: #666;
        }
        .upload-wardrobe-steps {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .upload-step {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
            padding: 15px;
            background-color: #f9f3f5;
            border-radius: 10px;
            text-align: center;
        }
        .upload-step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-color: #e75480;
            color: white;
            border-radius: 50%;
            line-height: 30px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .upload-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        .category-selector {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 200px;
            font-size: 16px;
        }
        .upload-input {
            display: none;
        }
        .upload-btn {
            background-color: #e75480;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        .upload-btn:hover {
            background-color: #d64d78;
        }
        .enhance-btn {
            background-color: #9370DB;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-top: 5px;
        }
        .enhance-btn:hover {
            background-color: #8360cb;
        }
        .upload-progress {
            width: 100%;
            max-width: 300px;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            display: none;
        }
        .upload-progress-bar {
            height: 100%;
            background-color: #e75480;
            width: 0%;
            transition: width 0.3s;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        .modal {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .modal-title {
            font-size: 20px;
            color: #e75480;
            font-weight: 600;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        .ai-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .ai-option {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            width: calc(50% - 10px);
            text-align: center;
            transition: all 0.2s;
        }
        .ai-option:hover, .ai-option.selected {
            border-color: #e75480;
            background-color: #fcf2f6;
        }
        .ai-preview {
            text-align: center;
            margin: 15px 0;
        }
        .ai-preview img {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .dropdown-container {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .dropdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 250px;
        }
        
        .dropdown-label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #e75480;
            display: block;
        }
        
        .style-dropdown, .occasion-dropdown {
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid #e0e0e0;
            background-color: white;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
            color: #333;
            text-align: center;
            font-family: 'Montserrat', Arial, sans-serif;
        }
        .social-share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1100;
        }
        
        .social-share-content {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
        }
        
        .social-share-title {
            color: #e75480;
            margin-bottom: 20px;
        }
        
        .comparison-image {
            max-width: 100%;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .share-button {
            padding: 8px 15px;
            border-radius: 25px;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .facebook-share {
            background-color: #3b5998;
        }
        
        .twitter-share {
            background-color: #1da1f2;
        }
        
        .pinterest-share {
            background-color: #bd081c;
        }
        
        .download-share {
            background-color: #4CAF50;
        }
        
        .compare-outfits-container {
            margin: 15px 0;
            text-align: center;
        }
        
        .compare-button {
            background-color: #9370DB;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .compare-button:hover {
            background-color: #8360cb;
        }
        
        .outfit-checkbox {
            display: none;
        }
        
        .outfit-select-label {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s, background-color 0.2s;
        }
        
        .saved-outfit:hover .outfit-select-label {
            opacity: 1;
        }
        
        .outfit-checkbox:checked + .outfit-select-label {
            background-color: #4CAF50;
            opacity: 1;
        }
        
        .comparison-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-left-color: #e75480;
            animation: spin 1s linear infinite;
            margin: 20px 0;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>AI Stylist</h1>
        <div>
            <a href="/">Home</a>
            <a href="/outfit-pairing">Outfit Pairing</a>
        </div>
    </div>

    <div class="container">
        <p style="text-align: center; font-family: 'Dancing Script', cursive; font-size: 32px; margin: 20px 0 30px; color: #e75480;">Mix & Match Your Perfect Look</p>

        <div class="dropdown-container">
            <div class="dropdown-item">
                <label for="style-dropdown" class="dropdown-label">Select Style</label>
                <select id="style-dropdown" class="style-dropdown">
                    <option value="">Choose a style...</option>
                    <option value="casual">Casual</option>
                    <option value="formal">Formal</option>
                    <option value="sporty">Sporty</option>
                    <option value="vintage">Vintage</option>
                    <option value="boho">Boho</option>
                    <option value="preppy">Preppy</option>
                </select>
            </div>

            <div class="dropdown-item">
                <label for="occasion-dropdown" class="dropdown-label">What's Your Occasion?</label>
                <select id="occasion-dropdown" class="occasion-dropdown">
                    <option value="">Choose an occasion...</option>
                    <option value="date-night">Date Night</option>
                    <option value="work">Work</option>
                    <option value="weekend">Weekend</option>
                    <option value="party">Party</option>
                    <option value="vacation">Vacation</option>
                    <option value="workout">Workout</option>
                </select>
            </div>
        </div>
        <p class="event-description" id="event-description"></p>

        <div class="outfit-display">
            <div class="outfit-item">
                <span class="outfit-label">Upper</span>
                <div id="selected-upper-placeholder" style="display: block;">
                    <p style="color: #999;">Select an upper clothing item</p>
                </div>
                <img id="selected-upper-img" alt="Upper clothing" style="display: none;">
                <div class="navigation-buttons">
                    <button class="nav-button" id="prev-upper">←</button>
                    <button class="nav-button" id="next-upper">→</button>
                </div>
            </div>
            <div class="outfit-item">
                <span class="outfit-label">Bottom</span>
                <div id="selected-bottom-placeholder" style="display: block;">
                    <p style="color: #999;">Select a bottom</p>
                </div>
                <img id="selected-bottom-img" alt="Bottom" style="display: none;">
                <div class="navigation-buttons">
                    <button class="nav-button" id="prev-bottom">←</button>
                    <button class="nav-button" id="next-bottom">→</button>
                </div>
            </div>
            <div class="compliment-box" id="compliment-box"></div>
        </div>

        <div class="outfit-rating">
            <span class="star" data-rating="1">★</span>
            <span class="star" data-rating="2">★</span>
            <span class="star" data-rating="3">★</span>
            <span class="star" data-rating="4">★</span>
            <span class="star" data-rating="5">★</span>
        </div>

        <div class="button-container">
            <button class="clear-button" id="clear-selections">Clear Selections</button>
            <button class="suggest-button" id="suggest-outfit">Suggest Outfit</button>
            <button class="save-button" id="save-outfit">Save Outfit</button>
        </div>

        <div class="clothing-gallery">
            <div class="gallery-section">
                <h2 class="gallery-title">Upper Clothes</h2>
                <div class="gallery-items" id="upper-clothes">
                    {% for item in upper_clothes %}
                    <div class="gallery-item" data-filename="{{ item.filename }}">
                        <img src="/database/UpperClothes/{{ item.filename }}" alt="Upper clothing item">
                        <button class="delete-item-btn" data-category="UpperClothes" data-filename="{{ item.filename }}">×</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="gallery-section">
                <h2 class="gallery-title">Bottoms</h2>
                <div class="gallery-items" id="bottoms">
                    {% for item in bottoms %}
                    <div class="gallery-item" data-filename="{{ item.filename }}">
                        <img src="/database/Bottoms/{{ item.filename }}" alt="Bottom clothing item">
                        <button class="delete-item-btn" data-category="Bottoms" data-filename="{{ item.filename }}">×</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="saved-outfits" id="saved-outfits" style="display: none;">
            <h2 class="saved-outfits-title">Saved Outfits</h2>
            <div class="saved-outfits-container" id="saved-outfits-container"></div>
        </div>

        <div class="upload-wardrobe">
            <h2 class="upload-wardrobe-title">Add to Your Wardrobe</h2>
            <p class="upload-wardrobe-description">Upload your clothing items to create even more outfit combinations!</p>
            
            <div class="upload-wardrobe-steps">
                <div class="upload-step">
                    <div class="upload-step-number">1</div>
                    <h3>Take a Photo</h3>
                    <p>Take a clear photo of your clothing item against a plain background.</p>
                </div>
                <div class="upload-step">
                    <div class="upload-step-number">2</div>
                    <h3>Upload & Categorize</h3>
                    <p>Upload your photo and select if it's an upper or bottom item.</p>
                </div>
                <div class="upload-step">
                    <div class="upload-step-number">3</div>
                    <h3>Enhance If Needed</h3>
                    <p>Use our AI to improve the image quality or generate a similar item.</p>
                </div>
            </div>
            
            <div class="upload-form">
                <select class="category-selector" id="category-selector">
                    <option value="">Select Category</option>
                    <option value="UpperClothes">Upper Clothing</option>
                    <option value="Bottoms">Bottoms</option>
                </select>
                <input type="file" id="wardrobe-upload" class="upload-input" accept="image/*">
                <button class="upload-btn" id="select-file-btn">Select Image</button>
                <div class="upload-progress" id="upload-progress">
                    <div class="upload-progress-bar" id="upload-progress-bar"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- AI Enhancement Modal -->
    <div class="modal-overlay" id="enhance-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Enhance Your Image</h3>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            <p>Your uploaded image may not be ideal. Choose an option below:</p>
            
            <div class="ai-options">
                <div class="ai-option" data-option="original">
                    <h4>Use Original</h4>
                    <p>Use your uploaded image as is</p>
                </div>
                <div class="ai-option" data-option="enhance">
                    <h4>Enhance Quality</h4>
                    <p>Improve clarity and remove background</p>
                </div>
                <div class="ai-option" data-option="similar">
                    <h4>Generate Similar</h4>
                    <p>Create an AI version of similar clothing</p>
                </div>
                <div class="ai-option" data-option="ideal">
                    <h4>Idealized Version</h4>
                    <p>Perfect, cleaned up version</p>
                </div>
            </div>
            
            <div class="ai-preview">
                <img id="ai-preview-img" src="" alt="Preview">
            </div>
            
            <div style="text-align: center;">
                <button class="upload-btn" id="save-enhanced">Save to Wardrobe</button>
            </div>
        </div>
    </div>

    <!-- Delete confirmation dialog (hidden by default) -->
    <div id="delete-confirmation" class="delete-confirmation-overlay" style="display: none;">
        <div class="delete-confirmation-box">
            <h3>Delete Item</h3>
            <p>Are you sure you want to delete this item from your wardrobe? This action cannot be undone.</p>
            <div class="delete-confirmation-buttons">
                <button id="delete-cancel" class="delete-cancel-btn">Cancel</button>
                <button id="delete-confirm" class="delete-confirm-btn">Yes, Delete It</button>
            </div>
        </div>
    </div>

    <!-- Social Share Modal -->
    <div id="social-share-modal" class="social-share-modal">
        <div class="social-share-content">
            <h3 class="social-share-title">Share Your Outfit Battle</h3>
            <div id="comparison-loading">
                <div class="comparison-spinner"></div>
                <p>Creating your outfit VS image...</p>
            </div>
            <img id="comparison-image" class="comparison-image" src="" alt="Outfit comparison" style="display: none;">
            <p>Share this outfit comparison with your friends!</p>
            <div class="share-buttons">
                <button class="share-button facebook-share" id="facebook-share">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        <path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/>
                    </svg>
                    Facebook
                </button>
                <button class="share-button twitter-share" id="twitter-share">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                    </svg>
                    Twitter
                </button>
                <button class="share-button pinterest-share" id="pinterest-share">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        <path d="M9.04 21.54c.96.29 1.93.46 2.96.46a10 10 0 0 0 10-10A10 10 0 0 0 12 2 10 10 0 0 0 2 12c0 4.25 2.67 7.9 6.44 9.34-.09-.78-.18-2.07 0-2.96l1.15-4.94s-.29-.58-.29-1.5c0-1.38.86-2.41 1.84-2.41.86 0 1.26.63 1.26 1.44 0 .86-.57 2.09-.86 3.27-.17.98.52 1.84 1.52 1.84 1.78 0 3.16-1.9 3.16-4.58 0-2.4-1.72-4.04-4.19-4.04-2.82 0-4.48 2.1-4.48 4.31 0 .86.28 1.73.74 2.3.09.06.09.14.06.29l-.29 1.09c0 .17-.11.23-.28.11-1.28-.56-2.02-2.38-2.02-3.85 0-3.16 2.24-6.03 6.56-6.03 3.44 0 6.12 2.47 6.12 5.75 0 3.44-2.13 6.2-5.18 6.2-.97 0-1.92-.52-2.26-1.13l-.67 2.37c-.23.86-.86 2.01-1.29 2.7v-.03z"/>
                    </svg>
                    Pinterest
                </button>
                <button class="share-button download-share" id="download-share">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    Download
                </button>
            </div>
            <button id="close-share-modal" style="margin-top: 20px; background: none; border: none; cursor: pointer;">Close</button>
        </div>
    </div>

    <script>
        // Initialize variables
        let upperClothes = Array.from(document.querySelectorAll('#upper-clothes .gallery-item'));
        let bottoms = Array.from(document.querySelectorAll('#bottoms .gallery-item'));
        let currentUpperIndex = -1;
        let currentBottomIndex = -1;
        let savedOutfits = [];
        let currentStyle = '';
        let currentEvent = '';
        
        // Initialize outfit display
        const selectedUpperImg = document.getElementById('selected-upper-img');
        const selectedBottomImg = document.getElementById('selected-bottom-img');
        
        // Click handlers for clothing items
        upperClothes.forEach((item, index) => {
            item.addEventListener('click', function() {
                selectUpper(index);
            });
        });
        
        bottoms.forEach((item, index) => {
            item.addEventListener('click', function() {
                selectBottom(index);
            });
        });
        
        // Event descriptions
        const eventDescriptions = {
            'date-night': 'Look your best for a special evening with elegant and romantic outfit choices.',
            'work': 'Professional and polished looks suitable for the office or business settings.',
            'weekend': 'Comfortable yet stylish casual outfits for your days off.',
            'party': 'Fun, vibrant outfits perfect for celebrations and social gatherings.',
            'vacation': 'Relaxed and versatile pieces for traveling and sightseeing.',
            'workout': 'Functional and fashionable activewear for your fitness routine.'
        };
        
        // Style dropdown handler
        document.getElementById('style-dropdown').addEventListener('change', function() {
            const style = this.value;
            currentStyle = style;
            
            if (style) {
                suggestOutfitByStyle(style);
            }
        });
        
        // Occasion dropdown handler
        document.getElementById('occasion-dropdown').addEventListener('change', function() {
            const event = this.value;
            currentEvent = event;
            
            const eventDescription = document.getElementById('event-description');
            if (event) {
                eventDescription.textContent = eventDescriptions[event];
                suggestOutfitByEvent(event);
            } else {
                eventDescription.textContent = '';
            }
        });
        
        // Compliments array
        const compliments = [
            "This outfit is absolutely stunning on you!",
            "You look fabulous in this combination!",
            "This style totally brings out your best features!",
            "You're going to turn heads in this outfit!",
            "This look is perfect for your personality!",
            "I love how this outfit highlights your uniqueness!",
            "You've got amazing style sense!",
            "This outfit showcases your fashion expertise!",
            "You look like you just stepped off a runway!",
            "This combination is a perfect match for you!"
        ];
        
        // Show random compliment when an outfit is created
        function showRandomCompliment() {
            const complimentBox = document.getElementById('compliment-box');
            const randomIndex = Math.floor(Math.random() * compliments.length);
            complimentBox.textContent = compliments[randomIndex];
            complimentBox.style.display = 'block';
        }
        
        function updateCompliment() {
            if (currentUpperIndex >= 0 && currentBottomIndex >= 0) {
                showRandomCompliment();
            }
        }
        
        // Suggest outfit by event
        function suggestOutfitByEvent(event) {
            // In a real app, you would have a backend API that returns appropriate outfits
            // for different events. Here, we'll simulate it with some basic logic
            
            // Different random selection strategies based on event type
            let upperIndex, bottomIndex;
            
            switch(event) {
                case 'date-night':
                    // For date night, prefer dressier options
                    // For demo, we'll just use random selection
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
                    break;
                    
                case 'work':
                    // For work, prefer formal/professional options
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
                    break;
                    
                case 'weekend':
                    // For weekend, prefer casual options
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
                    break;
                    
                case 'party':
                    // For party, prefer colorful/distinctive options
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
                    break;
                    
                case 'vacation':
                    // For vacation, prefer comfortable/light options
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
                    break;
                    
                case 'workout':
                    // For workout, prefer athletic options
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
                    break;
                    
                default:
                    // Default random selection
                    upperIndex = Math.floor(Math.random() * upperClothes.length);
                    bottomIndex = Math.floor(Math.random() * bottoms.length);
            }
            
            // Apply the selections
            if (upperIndex !== undefined && upperClothes.length > 0) {
                selectUpper(upperIndex);
            }
            
            if (bottomIndex !== undefined && bottoms.length > 0) {
                selectBottom(bottomIndex);
            }
        }
        
        // Suggest outfit by style (basic implementation - would need backend integration for real styling)
        function suggestOutfitByStyle(style) {
            // This is a simple implementation. In a real app, you'd have style categories in the backend
            // and would filter outfit suggestions based on the style.
            
            // For now, we'll just suggest random outfits when a style is clicked
            if (upperClothes.length > 0) {
                const randomUpperIndex = Math.floor(Math.random() * upperClothes.length);
                selectUpper(randomUpperIndex);
            }
            
            if (bottoms.length > 0) {
                const randomBottomIndex = Math.floor(Math.random() * bottoms.length);
                selectBottom(randomBottomIndex);
            }
        }
        
        // Handle star ratings
        const stars = document.querySelectorAll('.star');
        let currentRating = 0;
        
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = parseInt(this.getAttribute('data-rating'));
                currentRating = rating;
                
                // Update star display
                stars.forEach(s => {
                    const starRating = parseInt(s.getAttribute('data-rating'));
                    if (starRating <= rating) {
                        s.classList.add('active');
                    } else {
                        s.classList.remove('active');
                    }
                });
                
                // Save rating with the outfit if one is selected
                if (currentUpperIndex >= 0 && currentBottomIndex >= 0) {
                    // In a real app, you'd send this rating to the backend
                    console.log(`Outfit rated ${rating}/5 stars`);
                }
            });
        });
        
        // Save outfit
        document.getElementById('save-outfit').addEventListener('click', function() {
            if (currentUpperIndex >= 0 && currentBottomIndex >= 0) {
                const upperFileName = upperClothes[currentUpperIndex].getAttribute('data-filename');
                const bottomFileName = bottoms[currentBottomIndex].getAttribute('data-filename');
                
                const outfit = {
                    id: Date.now(),
                    upper: {
                        index: currentUpperIndex,
                        filename: upperFileName,
                        src: `/database/UpperClothes/${upperFileName}`
                    },
                    bottom: {
                        index: currentBottomIndex,
                        filename: bottomFileName,
                        src: `/database/Bottoms/${bottomFileName}`
                    },
                    rating: currentRating,
                    style: currentStyle,
                    event: currentEvent
                };
                
                savedOutfits.push(outfit);
                saveOutfitsToLocalStorage();
                renderSavedOutfits();
                
                // Show saved outfits section if it was hidden
                document.getElementById('saved-outfits').style.display = 'block';
                
                // Reset rating after saving
                stars.forEach(s => s.classList.remove('active'));
                currentRating = 0;
            } else {
                alert('Please select both upper and bottom items before saving the outfit.');
            }
        });
        
        // Load saved outfits from localStorage on page load
        function loadSavedOutfits() {
            const savedOutfitsJson = localStorage.getItem('savedOutfits');
            if (savedOutfitsJson) {
                savedOutfits = JSON.parse(savedOutfitsJson);
                if (savedOutfits.length > 0) {
                    document.getElementById('saved-outfits').style.display = 'block';
                    renderSavedOutfits();
                }
            }
        }
        
        // Save outfits to localStorage
        function saveOutfitsToLocalStorage() {
            localStorage.setItem('savedOutfits', JSON.stringify(savedOutfits));
        }
        
        // Render saved outfits
        function renderSavedOutfits() {
            const container = document.getElementById('saved-outfits-container');
            container.innerHTML = '';
            
            savedOutfits.forEach(outfit => {
                const outfitElement = document.createElement('div');
                outfitElement.className = 'saved-outfit';
                
                // Create stars HTML based on rating
                let starsHtml = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= outfit.rating) {
                        starsHtml += '<span class="star active">★</span>';
                    } else {
                        starsHtml += '<span class="star">★</span>';
                    }
                }
                
                // Create tags HTML
                let tagsHtml = '<div class="tags">';
                
                // Add style tag if available
                if (outfit.style) {
                    tagsHtml += `<div class="style-tag">${outfit.style}</div>`;
                }
                
                // Add event tag if available
                if (outfit.event) {
                    // Make event name more readable (replace hyphens with spaces and capitalize)
                    const eventName = outfit.event.replace(/-/g, ' ');
                    tagsHtml += `<div class="event-tag">${eventName}</div>`;
                }
                
                tagsHtml += '</div>';
                
                outfitElement.innerHTML = `
                    <input type="checkbox" id="outfit-${outfit.id}" class="outfit-checkbox" data-outfit-id="${outfit.id}">
                    <label for="outfit-${outfit.id}" class="outfit-select-label">+</label>
                    <button class="delete-outfit" data-id="${outfit.id}">×</button>
                    <div class="outfit-preview">
                        <img src="${outfit.upper.src}" alt="Upper clothing">
                        <img src="${outfit.bottom.src}" alt="Bottom">
                    </div>
                    <div class="outfit-details">
                        ${tagsHtml}
                        <div class="outfit-rating">${starsHtml}</div>
                    </div>
                `;
                
                container.appendChild(outfitElement);
                
                // Add event listener to checkbox
                const checkbox = outfitElement.querySelector('.outfit-checkbox');
                checkbox.addEventListener('change', function() {
                    const checkedOutfits = document.querySelectorAll('.outfit-checkbox:checked');
                    
                    // If more than 2 are selected, uncheck this one
                    if (checkedOutfits.length > 2 && this.checked) {
                        this.checked = false;
                        alert('You can only select two outfits to compare.');
                    }
                    
                    updateCompareButton();
                });
                
                // Add event listener to delete button
                outfitElement.querySelector('.delete-outfit').addEventListener('click', function() {
                    const outfitId = parseInt(this.getAttribute('data-id'));
                    savedOutfits = savedOutfits.filter(outfit => outfit.id !== outfitId);
                    saveOutfitsToLocalStorage();
                    renderSavedOutfits();
                    
                    // Hide the section if no saved outfits
                    if (savedOutfits.length === 0) {
                        document.getElementById('saved-outfits').style.display = 'none';
                    } else {
                        updateCompareButton();
                    }
                });
                
                // Add event listener to load the outfit when clicked
                outfitElement.querySelector('.outfit-preview').addEventListener('click', function(e) {
                    // Don't trigger if clicking the checkbox or delete button
                    if (e.target.closest('.outfit-select-label') || e.target.closest('.delete-outfit')) {
                        return;
                    }
                    
                    selectUpper(outfit.upper.index);
                    selectBottom(outfit.bottom.index);
                });
            });
            
            // Update compare button state
            updateCompareButton();
        }
        
        // Load saved outfits on page load
        loadSavedOutfits();
        
        // Suggest random outfit
        document.getElementById('suggest-outfit').addEventListener('click', function() {
            if (upperClothes.length > 0) {
                const randomUpperIndex = Math.floor(Math.random() * upperClothes.length);
                selectUpper(randomUpperIndex);
            }
            
            if (bottoms.length > 0) {
                const randomBottomIndex = Math.floor(Math.random() * bottoms.length);
                selectBottom(randomBottomIndex);
            }
        });
        
        // Handle upper clothes selection
        document.querySelectorAll('.upper-item').forEach((item, index) => {
            item.addEventListener('click', function() {
                selectUpper(index);
            });
        });

        // Handle bottoms selection
        document.querySelectorAll('.bottom-item').forEach((item, index) => {
            item.addEventListener('click', function() {
                selectBottom(index);
            });
        });
        
        // Navigation buttons for upper clothing
        document.getElementById('next-upper').addEventListener('click', function(e) {
            e.stopPropagation(); // Prevent triggering the gallery item click
            
            if (upperClothes.length === 0) return;
            
            if (currentUpperIndex < 0) {
                // If nothing is selected, select the first item
                selectUpper(0);
            } else {
                // Select the next item, or cycle back to 0
                const nextIndex = (currentUpperIndex + 1) % upperClothes.length;
                selectUpper(nextIndex);
            }
        });
        
        document.getElementById('prev-upper').addEventListener('click', function(e) {
            e.stopPropagation(); // Prevent triggering the gallery item click
            
            if (upperClothes.length === 0) return;
            
            if (currentUpperIndex < 0) {
                // If nothing is selected, select the last item
                selectUpper(upperClothes.length - 1);
            } else {
                // Select the previous item, or cycle to the end
                const prevIndex = (currentUpperIndex - 1 + upperClothes.length) % upperClothes.length;
                selectUpper(prevIndex);
            }
        });
        
        // Navigation buttons for bottoms
        document.getElementById('next-bottom').addEventListener('click', function(e) {
            e.stopPropagation(); // Prevent triggering the gallery item click
            
            if (bottoms.length === 0) return;
            
            if (currentBottomIndex < 0) {
                // If nothing is selected, select the first item
                selectBottom(0);
            } else {
                // Select the next item, or cycle back to 0
                const nextIndex = (currentBottomIndex + 1) % bottoms.length;
                selectBottom(nextIndex);
            }
        });
        
        document.getElementById('prev-bottom').addEventListener('click', function(e) {
            e.stopPropagation(); // Prevent triggering the gallery item click
            
            if (bottoms.length === 0) return;
            
            if (currentBottomIndex < 0) {
                // If nothing is selected, select the last item
                selectBottom(bottoms.length - 1);
            } else {
                // Select the previous item, or cycle to the end
                const prevIndex = (currentBottomIndex - 1 + bottoms.length) % bottoms.length;
                selectBottom(prevIndex);
            }
        });
        
        function selectUpper(index) {
            currentUpperIndex = index;
            
            // Remove selection from all upper clothes
            document.querySelectorAll('.upper-item').forEach(i => i.classList.remove('selected'));
            
            // Add selection to clicked item
            upperClothes[index].classList.add('selected');
            
            // Update display
            const filename = upperClothes[index].getAttribute('data-filename');
            const imageSrc = `/database/UpperClothes/${filename}`;
            document.getElementById('selected-upper-img').src = imageSrc;
            document.getElementById('selected-upper-img').style.display = 'block';
            document.getElementById('selected-upper-placeholder').style.display = 'none';
            
            // Show compliment if both items are selected
            updateCompliment();
        }
        
        function selectBottom(index) {
            currentBottomIndex = index;
            
            // Remove selection from all bottoms
            document.querySelectorAll('.bottom-item').forEach(i => i.classList.remove('selected'));
            
            // Add selection to clicked item
            bottoms[index].classList.add('selected');
            
            // Update display
            const filename = bottoms[index].getAttribute('data-filename');
            const imageSrc = `/database/Bottoms/${filename}`;
            document.getElementById('selected-bottom-img').src = imageSrc;
            document.getElementById('selected-bottom-img').style.display = 'block';
            document.getElementById('selected-bottom-placeholder').style.display = 'none';
            
            // Show compliment if both items are selected
            updateCompliment();
        }

        // Handle clear button
        document.getElementById('clear-selections').addEventListener('click', function() {
            // Clear selections
            document.querySelectorAll('.gallery-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Clear display
            document.getElementById('selected-upper-img').style.display = 'none';
            document.getElementById('selected-upper-placeholder').style.display = 'block';
            document.getElementById('selected-bottom-img').style.display = 'none';
            document.getElementById('selected-bottom-placeholder').style.display = 'block';
            
            // Reset dropdowns
            document.getElementById('style-dropdown').value = '';
            document.getElementById('occasion-dropdown').value = '';
            document.getElementById('event-description').textContent = '';
            
            // Hide compliment
            document.getElementById('compliment-box').style.display = 'none';
            
            // Reset indices and current selections
            currentUpperIndex = -1;
            currentBottomIndex = -1;
            currentStyle = '';
            currentEvent = '';
        });

        // Wardrobe upload functionality
        const categorySelector = document.getElementById('category-selector');
        const wardrobeUpload = document.getElementById('wardrobe-upload');
        const selectFileBtn = document.getElementById('select-file-btn');
        const uploadProgress = document.getElementById('upload-progress');
        const uploadProgressBar = document.getElementById('upload-progress-bar');
        const enhanceModal = document.getElementById('enhance-modal');
        const closeModal = document.getElementById('close-modal');
        const aiPreviewImg = document.getElementById('ai-preview-img');
        const saveEnhanced = document.getElementById('save-enhanced');
        
        let uploadedImageFile = null;
        let selectedCategory = '';
        let selectedEnhanceOption = 'original';
        
        // Open file dialog when select button is clicked
        selectFileBtn.addEventListener('click', function() {
            if (!categorySelector.value) {
                alert('Please select a category first');
                return;
            }
            wardrobeUpload.click();
        });
        
        // Handle category selection
        categorySelector.addEventListener('change', function() {
            selectedCategory = this.value;
        });
        
        // Handle file selection
        wardrobeUpload.addEventListener('change', function(e) {
            if (e.target.files.length === 0) return;
            
            uploadedImageFile = e.target.files[0];
            
            // Show the file name on the button
            selectFileBtn.textContent = uploadedImageFile.name;
            
            // Display upload progress
            uploadProgress.style.display = 'block';
            uploadProgressBar.style.width = '0%';
            
            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                uploadProgressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Show the enhancement modal
                    showEnhanceModal();
                }
            }, 50);
        });
        
        // Show enhancement modal
        function showEnhanceModal() {
            // Display the original image in the preview
            const reader = new FileReader();
            reader.onload = function(e) {
                aiPreviewImg.src = e.target.result;
            };
            reader.readAsDataURL(uploadedImageFile);
            
            // Show the modal
            enhanceModal.style.display = 'flex';
        }
        
        // Close modal when X is clicked
        closeModal.addEventListener('click', function() {
            enhanceModal.style.display = 'none';
        });
        
        // Handle AI option selection
        document.querySelectorAll('.ai-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove selection from all options
                document.querySelectorAll('.ai-option').forEach(o => o.classList.remove('selected'));
                
                // Select clicked option
                this.classList.add('selected');
                
                selectedEnhanceOption = this.getAttribute('data-option');
                
                // In a real app, this would call an AI API to generate the enhanced preview
                // For now, we'll just simulate it by keeping the original image
                console.log(`Selected enhancement option: ${selectedEnhanceOption}`);
            });
        });
        
        // Save enhanced image to wardrobe
        saveEnhanced.addEventListener('click', function() {
            // In a real app, this would upload the enhanced image to the server
            // For this demo, we'll simulate adding it to the wardrobe
            
            const formData = new FormData();
            formData.append('file', uploadedImageFile);
            formData.append('category', selectedCategory);
            formData.append('enhance_option', selectedEnhanceOption);
            
            fetch('/add_to_wardrobe', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close the modal
                    enhanceModal.style.display = 'none';
                    
                    // Reset the upload form
                    selectFileBtn.textContent = 'Select Image';
                    uploadProgress.style.display = 'none';
                    wardrobeUpload.value = '';
                    
                    // Show success message
                    alert('Item successfully added to your wardrobe! Refresh the page to see your new item.');
                    
                    // In a production app, you would dynamically add the new item to the galleries
                    // without requiring a page refresh
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while adding the item to your wardrobe.');
            });
        });

        // Delete item functionality
        let itemToDelete = null;
        
        // Add click event listeners to all delete buttons
        document.querySelectorAll('.delete-item-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation(); // Prevent triggering the gallery item click
                
                // Store reference to the item to delete
                itemToDelete = {
                    element: this.parentElement,
                    filename: this.getAttribute('data-filename'),
                    category: this.getAttribute('data-category')
                };
                
                // Show the confirmation dialog
                document.getElementById('delete-confirmation').style.display = 'flex';
            });
        });
        
        // Cancel delete
        document.getElementById('delete-cancel').addEventListener('click', function() {
            document.getElementById('delete-confirmation').style.display = 'none';
            itemToDelete = null;
        });
        
        // Confirm delete
        document.getElementById('delete-confirm').addEventListener('click', function() {
            if (!itemToDelete) return;
            
            // Send delete request to server
            fetch('/delete-wardrobe-item', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    filename: itemToDelete.filename,
                    category: itemToDelete.category
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Remove the item from the DOM
                    itemToDelete.element.remove();
                    
                    // If this was the selected item, clear the selection
                    if (itemToDelete.category === 'UpperClothes' && 
                        upperClothes[currentUpperIndex] && 
                        upperClothes[currentUpperIndex].getAttribute('data-filename') === itemToDelete.filename) {
                        clearUpperSelection();
                    }
                    
                    if (itemToDelete.category === 'Bottoms' && 
                        bottoms[currentBottomIndex] && 
                        bottoms[currentBottomIndex].getAttribute('data-filename') === itemToDelete.filename) {
                        clearBottomSelection();
                    }
                    
                    // Update the arrays of clothing items
                    if (itemToDelete.category === 'UpperClothes') {
                        upperClothes = Array.from(document.querySelectorAll('#upper-clothes .gallery-item'));
                        if (currentUpperIndex >= upperClothes.length) {
                            currentUpperIndex = -1;
                        }
                    } else {
                        bottoms = Array.from(document.querySelectorAll('#bottoms .gallery-item'));
                        if (currentBottomIndex >= bottoms.length) {
                            currentBottomIndex = -1;
                        }
                    }
                    
                    // Also remove from saved outfits if it exists there
                    const updatedSavedOutfits = savedOutfits.filter(outfit => {
                        if (itemToDelete.category === 'UpperClothes') {
                            return outfit.upper.filename !== itemToDelete.filename;
                        } else {
                            return outfit.bottom.filename !== itemToDelete.filename;
                        }
                    });
                    
                    if (updatedSavedOutfits.length !== savedOutfits.length) {
                        savedOutfits = updatedSavedOutfits;
                        saveOutfitsToLocalStorage();
                        renderSavedOutfits();
                    }
                    
                    // Hide the confirmation dialog
                    document.getElementById('delete-confirmation').style.display = 'none';
                    itemToDelete = null;
                } else {
                    alert('Error deleting item: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting the item');
            });
        });
        
        // Helper functions for clearing selections
        function clearUpperSelection() {
            const selectedUpperImg = document.getElementById('selected-upper-img');
            selectedUpperImg.src = '';
            selectedUpperImg.style.display = 'none';
            currentUpperIndex = -1;
            
            // Remove selected class from all upper clothes
            upperClothes.forEach(item => item.classList.remove('selected'));
        }
        
        function clearBottomSelection() {
            const selectedBottomImg = document.getElementById('selected-bottom-img');
            selectedBottomImg.src = '';
            selectedBottomImg.style.display = 'none';
            currentBottomIndex = -1;
            
            // Remove selected class from all bottoms
            bottoms.forEach(item => item.classList.remove('selected'));
        }

        // Add compare outfits button to the saved outfits section
        function updateCompareButton() {
            const savedOutfitsContainer = document.getElementById('saved-outfits');
            
            // Check if we already have a compare button
            let compareContainer = document.getElementById('compare-outfits-container');
            if (!compareContainer) {
                compareContainer = document.createElement('div');
                compareContainer.id = 'compare-outfits-container';
                compareContainer.className = 'compare-outfits-container';
                compareContainer.innerHTML = `
                    <p>Select two outfits to battle</p>
                    <button id="compare-outfits" class="compare-button" disabled>Create VS Battle</button>
                `;
                
                // Insert after the title
                const title = savedOutfitsContainer.querySelector('.saved-outfits-title');
                title.insertAdjacentElement('afterend', compareContainer);
                
                // Add event listener for compare button
                document.getElementById('compare-outfits').addEventListener('click', compareSelectedOutfits);
            }
            
            // Update button state based on selection count
            const checkedOutfits = document.querySelectorAll('.outfit-checkbox:checked');
            const compareButton = document.getElementById('compare-outfits');
            
            if (checkedOutfits.length === 2) {
                compareButton.disabled = false;
            } else {
                compareButton.disabled = true;
            }
            
            // Update instruction text
            const instructionText = compareContainer.querySelector('p');
            if (checkedOutfits.length === 0) {
                instructionText.textContent = 'Select two outfits to battle';
            } else if (checkedOutfits.length === 1) {
                instructionText.textContent = 'Select one more outfit for the battle';
            } else if (checkedOutfits.length === 2) {
                instructionText.textContent = 'Ready for the outfit battle!';
            } else {
                instructionText.textContent = 'Please select only two outfits';
            }
        }
        
        // Compare selected outfits and generate shareable image
        function compareSelectedOutfits() {
            const checkedOutfits = document.querySelectorAll('.outfit-checkbox:checked');
            
            if (checkedOutfits.length !== 2) {
                alert('Please select exactly two outfits to compare.');
                return;
            }
            
            const outfitsToCompare = [];
            
            checkedOutfits.forEach(checkbox => {
                const outfitId = parseInt(checkbox.getAttribute('data-outfit-id'));
                const outfit = savedOutfits.find(o => o.id === outfitId);
                
                if (outfit) {
                    outfitsToCompare.push({
                        upper_filename: outfit.upper.filename,
                        bottom_filename: outfit.bottom.filename,
                        style: outfit.style,
                        event: outfit.event,
                        rating: outfit.rating
                    });
                }
            });
            
            if (outfitsToCompare.length !== 2) {
                alert('Error finding selected outfits.');
                return;
            }
            
            // Show the share modal with loading state
            document.getElementById('social-share-modal').style.display = 'flex';
            document.getElementById('comparison-loading').style.display = 'block';
            document.getElementById('comparison-image').style.display = 'none';
            
            // Send request to generate comparison image
            fetch('/generate-outfit-comparison', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    outfits: outfitsToCompare
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Hide loading and show image
                    document.getElementById('comparison-loading').style.display = 'none';
                    
                    const comparisonImage = document.getElementById('comparison-image');
                    comparisonImage.src = data.url;
                    comparisonImage.style.display = 'block';
                    
                    // Set up share buttons
                    setupShareButtons(data.url);
                } else {
                    alert('Error generating comparison: ' + data.error);
                    document.getElementById('social-share-modal').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while generating the comparison.');
                document.getElementById('social-share-modal').style.display = 'none';
            });
        }
        
        // Set up share buttons with the image URL
        function setupShareButtons(imageUrl) {
            const fullImageUrl = window.location.origin + imageUrl;
            const pageTitle = 'My Outfit Comparison from AI Stylist';
            
            // Facebook
            document.getElementById('facebook-share').addEventListener('click', function() {
                const facebookShareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(fullImageUrl)}`;
                window.open(facebookShareUrl, '_blank');
            });
            
            // Twitter
            document.getElementById('twitter-share').addEventListener('click', function() {
                const twitterShareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(fullImageUrl)}&text=${encodeURIComponent(pageTitle)}`;
                window.open(twitterShareUrl, '_blank');
            });
            
            // Pinterest
            document.getElementById('pinterest-share').addEventListener('click', function() {
                const pinterestShareUrl = `https://pinterest.com/pin/create/button/?url=${encodeURIComponent(window.location.href)}&media=${encodeURIComponent(fullImageUrl)}&description=${encodeURIComponent(pageTitle)}`;
                window.open(pinterestShareUrl, '_blank');
            });
            
            // Download
            document.getElementById('download-share').addEventListener('click', function() {
                const a = document.createElement('a');
                a.href = imageUrl;
                a.download = 'outfit-comparison.jpg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
        }
        
        // Close share modal
        document.getElementById('close-share-modal').addEventListener('click', function() {
            document.getElementById('social-share-modal').style.display = 'none';
        });
    </script>
</body>
</html> 